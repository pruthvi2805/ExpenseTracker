#!/usr/bin/env bash

# Block pushes targeting protected remote branches, regardless of current branch.
protected_branches=("refs/heads/main" "refs/heads/master")

remote="$1"
url="$2"

block=false

# Read ref updates from stdin: "<local ref> <local sha> <remote ref> <remote sha>"
while read -r local_ref local_sha remote_ref remote_sha; do
  for b in "${protected_branches[@]}"; do
    if [[ "$remote_ref" == "$b" ]]; then
      block=true
      target="$b"
      break 2
    fi
  done
done

if [ "$block" = true ]; then
  echo "âœ– Push to '${target#refs/heads/}' is blocked by local hook."
  echo "  Create a feature branch and open a PR instead."
  echo "  Example: git switch -c feat/short-description && git push -u origin HEAD"
  exit 1
fi

exit 0
